<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Neon Project Tracker v2.4 - Hierarchical Glow Sync</title>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<style>
  body{margin:0;background:linear-gradient(180deg,#0a0a0a,#151515);font-family:'Segoe UI',sans-serif;color:#eee;overflow:hidden;}
  #sidebar{position:fixed;top:0;left:0;height:100vh;width:280px;background:#111;transform:translateX(-280px);transition:.3s;z-index:10;padding:1em;overflow-y:auto;box-shadow:2px 0 10px rgba(0,0,0,.6);}
  #sidebar.active{transform:translateX(0)}
  #sidebar h2{margin-top:0}
  #sidebar button,#toggleMenu{background:#222;color:#990f00;border:none;padding:.5em 1em;border-radius:8px;cursor:pointer;margin-top:.5em;}
  #toggleMenu{position:fixed;top:1em;left:1em;z-index:20}
  .folder{background:#1a1a1a;margin:.4em 0;padding:.5em;border-radius:6px;}
  .folder-header{display:flex;justify-content:space-between;align-items:center;cursor:pointer;color:#ddd;}
  .folder-children{padding-left:1em;margin-top:.3em;display:none;}
  .folder.open>.folder-children{display:block;}
  .folder-actions button{background:#222;color:#990f00;border:none;border-radius:6px;cursor:pointer;margin-left:.3em;padding:.2em .5em;}
  .project-item{background:#222;margin:.3em 0;padding:.3em .5em;border-radius:5px;display:flex;justify-content:space-between;align-items:center;}
  .project-item button{background:#333;color:#990f00;border:none;border-radius:5px;padding:.2em .5em;cursor:pointer;}
  #workspace{position:relative;width:100vw;height:100vh;overflow:hidden;cursor:grab;}
  svg{position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;}
  .project-header{text-align:center;padding-top:1em;position:relative;z-index:5;}
  .project-header h1{display:inline-block;font-size:1.8em;margin:.2em 0;}
  .project-header button.settings-btn{background:#222;border:none;color:var(--neon,#990f00);border-radius:6px;padding:.3em .7em;cursor:pointer;margin-left:.5em;}
  .progress-bar{height:6px;width:60%;margin:.5em auto;border-radius:3px;background:#222;overflow:hidden;}
  .progress-bar-fill{height:100%;width:0;background:var(--neon);transition:width .3s ease;box-shadow:0 0 10px var(--neon);}
  #progressCounter{font-size:1.1em;margin-bottom:.3em;opacity:.9;}
  .node{position:absolute;background:#222;border:2px solid #333;padding:.8em;border-radius:10px;width:200px;text-align:left;box-shadow:0 0 10px #000;transition:box-shadow .3s,border-color .3s,opacity 1s;cursor:grab;animation:pulse 3s ease-in-out infinite alternate;}
  .node.glow{box-shadow:0 0 20px var(--neon);border-color:var(--neon);}
  .node-controls{display:flex;justify-content:space-between;align-items:center}
  .node-controls button{background:#333;border:none;border-radius:5px;color:#990f00;cursor:pointer;padding:.2em .5em;}
  .deleteNodeBtn{color:#f44;font-weight:bold;margin-left:.3em;}
  .node textarea{width:100%;height:60px;background:transparent;color:#eee;border:none;resize:none;}
  .node img{margin-top:.5em;max-width:100%;border-radius:5px;}
  @keyframes pulse{0%{opacity:1;}100%{opacity:.75;}}
  .tube{stroke:#333;stroke-width:3;fill:none;stroke-dasharray:10 10;animation:lineFlow 4s linear infinite;transition:stroke .5s;}
  .tube.glow{stroke:var(--neon);filter:drop-shadow(0 0 6px var(--neon));}
  @keyframes lineFlow{to{stroke-dashoffset:-20;}}
  #modalOverlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.3);justify-content:center;align-items:center;z-index:100;}
  #settingsModal{background:#1a1a1a;border:1px solid #333;border-radius:10px;padding:1em 2em;text-align:center;color:#eee;min-width:300px;}
  #settingsModal input[type="text"]{width:80%;margin:.5em 0;background:#222;border:1px solid #444;color:#eee;padding:.3em;}
  #settingsModal input[type="color"],#settingsModal input[type="file"]{margin:.5em 0;}
  #settingsModal button{background:#222;border:none;color:var(--neon,#990f00);padding:.5em 1em;border-radius:6px;margin-top:.5em;cursor:pointer;}
  .deleteProjBtn{background:#300;color:#f55!important;margin-top:1em;}
  #zoomReset{position:fixed;left:1em;bottom:1em;z-index:20;background:#222;color:#990f00;border:none;padding:.5em 1em;border-radius:8px;cursor:pointer;box-shadow:0 0 8px #000;}
</style>
</head>
<body>
<button id="toggleMenu">‚ò∞</button>
<div id="sidebar">
  <h2>Folders</h2>
  <div id="folderList"></div>
  <button id="addRoot">+ New Folder</button>
</div>
<div id="workspace">
  <svg id="connections"></svg>
  <div class="project-header" id="projectHeader"><div id="progressCounter"></div></div>
  <div id="nodesContainer"></div>
  <button id="zoomReset">üîç Reset Zoom</button>
</div>
<div id="modalOverlay">
  <div id="settingsModal">
    <h2>Project Settings</h2>
    <label>Project Name</label><br>
    <input type="text" id="modalTitle"><br>
    <label>Neon Color</label><br>
    <input type="color" id="modalColor"><br>
    <label>Project Image</label><br>
    <input type="file" id="modalImg" accept="image/*"><br>
    <button id="closeModal">Close</button>
    <button class="deleteProjBtn" id="deleteProject">üóëÔ∏è Delete Project</button>
  </div>
</div>
<script>
let folders=JSON.parse(localStorage.getItem('neonFolders')||'[]');
let projects=JSON.parse(localStorage.getItem('neonProjects')||'{}');
let currentProject=null;
const folderList=document.getElementById('folderList');
const workspace=document.getElementById('workspace');
const connections=document.getElementById('connections');
const nodesContainer=document.getElementById('nodesContainer');
const projectHeader=document.getElementById('projectHeader');
const modalOverlay=document.getElementById('modalOverlay');
const modalTitle=document.getElementById('modalTitle');
const modalColor=document.getElementById('modalColor');
const modalImg=document.getElementById('modalImg');
const closeModal=document.getElementById('closeModal');
const deleteProject=document.getElementById('deleteProject');
const zoomReset=document.getElementById('zoomReset');
const toggleMenu=document.getElementById('toggleMenu');
const sidebar=document.getElementById('sidebar');
let scale=1,originX=0,originY=0,isPanning=false,startX,startY;

toggleMenu.onclick=()=>sidebar.classList.toggle('active');
function save(){localStorage.setItem('neonFolders',JSON.stringify(folders));localStorage.setItem('neonProjects',JSON.stringify(projects));}
function renderFolders(){folderList.innerHTML='';const makeTree=(parentId)=>{return folders.filter(f=>f.parentId===parentId).map(f=>{const childProjects=projects[f.id]||[];return `<div class='folder' data-id='${f.id}'><div class='folder-header'><span>${f.name}</span><div class='folder-actions'><button class='rename'>‚úèÔ∏è</button><button class='delete'>üóëÔ∏è</button><button class='newProj'>üìÑ</button></div></div><div class='folder-children'>${childProjects.map(p=>`<div class='project-item' data-pid='${p.id}'>${p.title}<button class='openProj'>Open</button><button class='delProj'>‚ùå</button></div>`).join('')}${makeTree(f.id).join('')}</div></div>`;});};folderList.innerHTML=makeTree(null).join('');enableFolderActions();Sortable.create(folderList,{group:'folders',animation:150,onEnd:()=>{save();renderFolders();}});}
function enableFolderActions(){document.querySelectorAll('.folder-header span').forEach(span=>span.onclick=e=>e.target.closest('.folder').classList.toggle('open'));
document.querySelectorAll('.rename').forEach(btn=>btn.onclick=()=>{const id=btn.closest('.folder').dataset.id;const f=folders.find(x=>x.id===id);const name=prompt('Rename folder:',f.name);if(name){f.name=name;save();renderFolders();}});
document.querySelectorAll('.delete').forEach(btn=>btn.onclick=()=>{const id=btn.closest('.folder').dataset.id;if(confirm('Delete folder?')){folders=folders.filter(x=>x.id!==id&&x.parentId!==id);delete projects[id];save();renderFolders();}});
document.querySelectorAll('.newProj').forEach(btn=>btn.onclick=()=>{const id=btn.closest('.folder').dataset.id;if(!projects[id])projects[id]=[];const pid='proj-'+Date.now();projects[id].push({id:pid,title:'New Project',color:'#990f00',image:'',nodes:[{id:'node-1',text:'Start Here',done:false,parent:null,x:400,y:200,image:''}]});save();renderFolders();});
document.querySelectorAll('.openProj').forEach(btn=>btn.onclick=()=>{const folderId=btn.closest('.folder').dataset.id;const pid=btn.closest('.project-item').dataset.pid;currentProject={folderId,pid};loadProject();});
document.querySelectorAll('.delProj').forEach(btn=>btn.onclick=()=>{const folderId=btn.closest('.folder').dataset.id;const pid=btn.closest('.project-item').dataset.pid;if(confirm('Delete this project?')){projects[folderId]=projects[folderId].filter(p=>p.id!==pid);save();renderFolders();}});}
function loadProject(){const {folderId,pid}=currentProject;const proj=projects[folderId].find(p=>p.id===pid);workspace.style.setProperty('--neon',proj.color);renderProject(proj);}
function renderProject(proj){const total=proj.nodes.length;const complete=proj.nodes.filter(n=>n.done&&isPathComplete(proj,n)).length;const pct=Math.round((complete/total)*100);projectHeader.innerHTML=`<h1>${proj.title}</h1><button class='settings-btn'>‚öôÔ∏è</button><div id='progressCounter'>Progress: ${pct}%</div><div class='progress-bar'><div class='progress-bar-fill' style='width:${pct}%;'></div></div>${proj.image?`<img src='${proj.image}' style='max-width:150px;border-radius:8px;'>`:''}`;document.querySelector('.settings-btn').onclick=()=>openSettings(proj);nodesContainer.innerHTML='';connections.innerHTML='';proj.nodes.forEach(n=>createNodeElement(n,proj.color,proj));drawConnections(proj);} 
function openSettings(proj){modalOverlay.style.display='flex';modalTitle.value=proj.title;modalColor.value=proj.color;modalImg.value=null;closeModal.onclick=()=>modalOverlay.style.display='none';deleteProject.onclick=()=>{if(confirm('Delete this project?')){const {folderId,pid}=currentProject;projects[folderId]=projects[folderId].filter(p=>p.id!==pid);save();modalOverlay.style.display='none';renderFolders();nodesContainer.innerHTML='';connections.innerHTML='';projectHeader.innerHTML='';}};modalTitle.oninput=()=>{proj.title=modalTitle.value;save();renderProject(proj);renderFolders();};modalColor.oninput=()=>{proj.color=modalColor.value;workspace.style.setProperty('--neon',proj.color);save();renderProject(proj);};modalImg.onchange=e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=()=>{proj.image=r.result;save();renderProject(proj);};r.readAsDataURL(f);};}
function isPathComplete(proj,node){if(!node.parent){const root=proj.nodes.find(n=>!n.parent);return root&&root.done;}const parent=proj.nodes.find(n=>n.id===node.parent);return parent&&parent.done&&isPathComplete(proj,parent);}
function createNodeElement(node,color,proj){const div=document.createElement('div');div.className='node';div.style.left=node.x+'px';div.style.top=node.y+'px';div.dataset.id=node.id;div.style.setProperty('--neon',color);if(node.done&&isPathComplete(proj,node))div.classList.add('glow');div.innerHTML=`<div class='node-controls'><input type='checkbox' class='done' ${node.done?'checked':''}><button class='addDown'>‚Üì</button><button class='addSide'>‚Üí</button><button class='deleteNodeBtn'>‚ùå</button><input type='file' class='imgInput' accept='image/*' style='width:60px'></div><textarea>${node.text}</textarea>${node.image?`<img src='${node.image}'>`:''}`;nodesContainer.appendChild(div);div.querySelector('.done').onchange=e=>{node.done=e.target.checked;save();renderProject(proj);};div.querySelector('.addDown').onclick=()=>addBranch(node.id,'down',proj);div.querySelector('.addSide').onclick=()=>addBranch(node.id,'side',proj);div.querySelector('.deleteNodeBtn').onclick=()=>deleteNode(node.id,proj);div.querySelector('textarea').oninput=e=>{node.text=e.target.value;save();};div.querySelector('.imgInput').onchange=e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=()=>{node.image=r.result;save();renderProject(proj);};r.readAsDataURL(f);};enableDrag(div,node,proj);} 
function deleteNode(nodeId,proj){function remove(id){proj.nodes.filter(n=>n.parent===id).forEach(child=>remove(child.id));proj.nodes=proj.nodes.filter(n=>n.id!==id);}remove(nodeId);save();renderProject(proj);}
function addBranch(parentId,dir,proj){const p=proj.nodes.find(n=>n.id===parentId);const newId='node-'+Date.now();const offset=dir==='down'?{x:0,y:250}:{x:300,y:0};const newNode={id:newId,text:'New Task',done:false,parent:parentId,x:p.x+offset.x,y:p.y+offset.y,image:''};proj.nodes.push(newNode);save();renderProject(proj);}
function drawConnections(proj){connections.innerHTML='';proj.nodes.forEach(n=>{if(n.parent){const p=proj.nodes.find(x=>x.id===n.parent);if(!p)return;const line=document.createElementNS('http://www.w3.org/2000/svg','line');const x1=(p.x+100)*scale+originX,y1=(p.y+100)*scale+originY,x2=(n.x+100)*scale+originX,y2=(n.y)*scale+originY;line.setAttribute('x1',x1);line.setAttribute('y1',y1);line.setAttribute('x2',x2);line.setAttribute('y2',y2);line.classList.add('tube');if(p.done&&n.done&&isPathComplete(proj,n))line.classList.add('glow');line.style.setProperty('--neon',proj.color);connections.appendChild(line);}});} 
function enableDrag(div,node,proj){let offX,offY,drag=false;div.addEventListener('pointerdown',e=>{if(['TEXTAREA','INPUT','BUTTON'].includes(e.target.tagName))return;drag=true;offX=e.clientX-node.x;offY=e.clientY-node.y;div.setPointerCapture(e.pointerId);});div.addEventListener('pointermove',e=>{if(!drag)return;const x=Math.round((e.clientX-offX)/50)*50;const y=Math.round((e.clientY-offY)/50)*50;node.x=x;node.y=y;div.style.left=x+'px';div.style.top=y+'px';drawConnections(proj);});div.addEventListener('pointerup',()=>{if(!drag)return;drag=false;save();renderProject(proj);});}
workspace.addEventListener('mousedown',e=>{
  if(e.target.closest('.node'))return;
  isPanning=true;
  startX=e.clientX-originX;
  startY=e.clientY-originY;
  workspace.style.cursor='grabbing';
});
workspace.addEventListener('mousemove',e=>{
  if(!isPanning)return;
  originX=e.clientX-startX;
  originY=e.clientY-startY;
  applyTransform();
  if(currentProject){
    const {folderId,pid}=currentProject;
    const proj=projects[folderId].find(p=>p.id===pid);
    drawConnections(proj);
  }
});
workspace.addEventListener('mouseup',()=>{
  isPanning=false;
  workspace.style.cursor='grab';
});
workspace.addEventListener('wheel',e=>{
  e.preventDefault();
  const delta=e.deltaY>0?-0.1:0.1;
  scale=Math.min(2,Math.max(0.5,scale+delta));
  applyTransform();
  if(currentProject){
    const {folderId,pid}=currentProject;
    const proj=projects[folderId].find(p=>p.id===pid);
    drawConnections(proj);
  }
});
zoomReset.onclick=()=>{
  scale=1;
  originX=0;
  originY=0;
  applyTransform();
  if(currentProject){
    const {folderId,pid}=currentProject;
    const proj=projects[folderId].find(p=>p.id===pid);
    drawConnections(proj);
  }
};
function applyTransform(){
  nodesContainer.style.transform=`translate(${originX}px,${originY}px) scale(${scale})`;
  connections.style.transform=`translate(${originX}px,${originY}px) scale(${scale})`;
}

// Initialize UI
renderFolders();
const firstFolder=folders[0];
if(firstFolder && projects[firstFolder.id] && projects[firstFolder.id][0]){
  currentProject={folderId:firstFolder.id,pid:projects[firstFolder.id][0].id};
  loadProject();
}
</script>
</body>
</html>
