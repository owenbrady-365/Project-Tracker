<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Neon Project Tracker v2.1</title>
<style>
  body {
    margin:0;background:linear-gradient(180deg,#0a0a0a,#151515);
    font-family:'Segoe UI',sans-serif;color:#eee;overflow:hidden;
  }

  /* Sidebar filesystem */
  #sidebar {
    position:fixed;top:0;left:0;height:100vh;width:270px;background:#111;
    transform:translateX(-280px);transition:.3s;z-index:10;padding:1em;
    box-shadow:2px 0 10px rgba(0,0,0,.6);overflow-y:auto;
  }
  #sidebar.active{transform:translateX(0)}
  #sidebar h2{margin-top:0}
  #sidebar button,#toggleMenu{
    background:#222;color:#990f00;border:none;
    padding:.5em 1em;border-radius:8px;cursor:pointer;margin-top:.5em;
  }
  #toggleMenu{position:fixed;top:1em;left:1em;z-index:20}
  .project-folder {
    margin:.5em 0;padding:.5em;background:#1a1a1a;border-radius:6px;
  }
  .project-folder h3 {
    margin:0;cursor:pointer;display:flex;justify-content:space-between;align-items:center;
  }
  .folder-content {
    margin-top:.5em;padding-left:1em;display:none;font-size:.9em;color:#ccc;
  }
  .folder-content.open{display:block}
  .folder-info {margin-bottom:.3em;}
  .folder-actions button {
    background:#222;border:none;color:#990f00;padding:.2em .5em;border-radius:6px;
    cursor:pointer;margin-right:.3em;
  }

  /* Workspace */
  #workspace{position:relative;width:100vw;height:100vh;overflow:hidden;cursor:grab;}
  .project-header{text-align:center;padding-top:1em;position:relative;z-index:5;}
  .project-header h1{display:inline-block;font-size:1.8em;margin:.2em 0;}
  .project-header button.settings-btn{
    background:#222;border:none;color:var(--neon,#990f00);
    border-radius:6px;padding:.3em .7em;cursor:pointer;margin-left:.5em;
  }
  .progress-bar{height:6px;width:60%;margin:.5em auto;border-radius:3px;
  background:#222;overflow:hidden;}
  .progress-bar-fill{height:100%;width:0;background:var(--neon);
  transition:width .3s ease;box-shadow:0 0 10px var(--neon);}
  #progressCounter{font-size:1.1em;margin-bottom:.3em;opacity:.9;}

  /* Nodes */
  .node{
    position:absolute;background:#222;border:2px solid #333;
    padding:.8em;border-radius:10px;width:200px;text-align:left;
    box-shadow:0 0 10px #000;transition:box-shadow .3s,border-color .3s,opacity 1s;
    cursor:grab;animation:pulse 3s ease-in-out infinite alternate;
  }
  .node.glow{box-shadow:0 0 20px var(--neon);border-color:var(--neon);}
  .node-controls{display:flex;justify-content:space-between;align-items:center}
  .node-controls button{background:#333;border:none;border-radius:5px;
    color:#990f00;cursor:pointer;padding:.2em .5em;}
  .deleteNodeBtn{color:#f44;font-weight:bold;margin-left:.3em;}
  .node textarea{width:100%;height:60px;background:transparent;color:#eee;border:none;resize:none;}
  .node img{margin-top:.5em;max-width:100%;border-radius:5px;}

  @keyframes pulse{0%{opacity:1;}100%{opacity:.75;}}

  /* Connections */
  svg{position:absolute;top:0;left:0;width:100%;height:100%;overflow:visible;z-index:0;}
  .tube{stroke:#333;stroke-width:3;fill:none;stroke-dasharray:10 10;
    animation:lineFlow 4s linear infinite;transition:stroke .5s;}
  .tube.glow{stroke:var(--neon);filter:drop-shadow(0 0 6px var(--neon));}
  @keyframes lineFlow{to{stroke-dashoffset:-20;}}

  /* Modal */
  #modalOverlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,.3);justify-content:center;align-items:center;z-index:100;}
  #settingsModal{background:#1a1a1a;border:1px solid #333;border-radius:10px;
    padding:1em 2em;text-align:center;color:#eee;min-width:300px;}
  #settingsModal input[type="text"]{width:80%;margin:.5em 0;background:#222;
    border:1px solid #444;color:#eee;padding:.3em;}
  #settingsModal input[type="color"],#settingsModal input[type="file"]{margin:.5em 0;}
  #settingsModal button{background:#222;border:none;color:var(--neon,#990f00);
    padding:.5em 1em;border-radius:6px;margin-top:.5em;cursor:pointer;}
  .deleteProjBtn{background:#300;color:#f55!important;margin-top:1em;}

  /* Zoom Reset */
  #zoomReset{
    position:fixed;left:1em;bottom:1em;z-index:20;background:#222;color:#990f00;
    border:none;padding:.5em 1em;border-radius:8px;cursor:pointer;box-shadow:0 0 8px #000;
  }
</style>
</head>
<body>
<button id="toggleMenu">‚ò∞</button>
<div id="sidebar">
  <h2>Projects</h2>
  <div id="projectList"></div>
  <button id="addProject">+ New Project</button>
</div>

<div id="workspace">
  <svg id="connections"></svg>
  <div class="project-header" id="projectHeader">
    <div id="progressCounter"></div>
  </div>
  <div id="nodesContainer"></div>
  <button id="zoomReset">üîç Reset Zoom</button>
</div>

<div id="modalOverlay">
  <div id="settingsModal">
    <h2>Project Settings</h2>
    <label>Project Name</label><br>
    <input type="text" id="modalTitle"><br>
    <label>Neon Color</label><br>
    <input type="color" id="modalColor"><br>
    <label>Project Image</label><br>
    <input type="file" id="modalImg" accept="image/*"><br>
    <button id="closeModal">Close</button>
    <button class="deleteProjBtn" id="deleteProject">üóëÔ∏è Delete Project</button>
  </div>
</div>

<script>
let data=JSON.parse(localStorage.getItem('neonTrackerData')||'{}');
let currentProjectId=null;
const projectList=document.getElementById('projectList'),
workspace=document.getElementById('workspace'),
nodesContainer=document.getElementById('nodesContainer'),
connections=document.getElementById('connections'),
projectHeader=document.getElementById('projectHeader'),
sidebar=document.getElementById('sidebar'),
toggleMenu=document.getElementById('toggleMenu'),
modalOverlay=document.getElementById('modalOverlay'),
modalTitle=document.getElementById('modalTitle'),
modalColor=document.getElementById('modalColor'),
modalImg=document.getElementById('modalImg'),
closeModal=document.getElementById('closeModal'),
deleteProject=document.getElementById('deleteProject'),
zoomReset=document.getElementById('zoomReset');

toggleMenu.onclick=()=>sidebar.classList.toggle('active');
document.getElementById('addProject').onclick=()=>{
  const id='proj-'+Date.now();
  data[id]={id,title:'New Project',color:'#990f00',image:'',
  nodes:[{id:'node-1',text:'Start Here',done:false,parent:null,
          x:window.innerWidth/2-100,y:200,image:''}]};
  save();loadProject(id);refreshProjectList();
};

function refreshProjectList(){
  projectList.innerHTML='';
  Object.values(data).forEach(p=>{
    const folder=document.createElement('div');
    folder.className='project-folder';
    const header=document.createElement('h3');
    header.innerHTML=`üìÅ ${p.title}<span>‚ñº</span>`;
    const content=document.createElement('div');
    content.className='folder-content';
    const total=p.nodes.length;
    const complete=p.nodes.filter(n=>n.done).length;
    content.innerHTML=`
      <div class="folder-info">Tasks: ${complete}/${total}</div>
      <div class="folder-actions">
        <button onclick="loadProject('${p.id}')">Open</button>
      </div>`;
    header.onclick=()=>content.classList.toggle('open');
    folder.appendChild(header);
    folder.appendChild(content);
    projectList.appendChild(folder);
  });
}
function save(){localStorage.setItem('neonTrackerData',JSON.stringify(data));}

function loadProject(id){
  currentProjectId=id;
  const proj=data[id];
  workspace.style.setProperty('--neon',proj.color);
  renderProject(proj);
}

function renderProject(proj){
  const total=proj.nodes.length;
  const complete=proj.nodes.filter(n=>n.done&&isPathComplete(proj,n)).length;
  const pct=Math.round((complete/total)*100);
  projectHeader.innerHTML=`
    <h1>${proj.title}</h1>
    <button class="settings-btn">‚öôÔ∏è</button>
    <div id="progressCounter">Progress: ${pct}%</div>
    <div class="progress-bar"><div class="progress-bar-fill" style="width:${pct}%;"></div></div>
    ${proj.image?`<img src="${proj.image}" style="max-width:150px;border-radius:8px;">`:''}`;
  document.querySelector('.settings-btn').onclick=()=>openSettings(proj);
  nodesContainer.innerHTML='';connections.innerHTML='';
  proj.nodes.forEach(n=>createNodeElement(n,proj.color));
  drawConnections(proj);
}

function openSettings(proj){
  modalOverlay.style.display='flex';
  modalTitle.value=proj.title;
  modalColor.value=proj.color;
  modalImg.value=null;
  closeModal.onclick=()=>modalOverlay.style.display='none';
  deleteProject.onclick=()=>{
    if(confirm('Delete this entire project?')){
      delete data[proj.id];save();modalOverlay.style.display='none';refreshProjectList();
      nodesContainer.innerHTML='';connections.innerHTML='';projectHeader.innerHTML='';
    }
  };
  modalTitle.oninput=()=>{proj.title=modalTitle.value;save();renderProject(proj);refreshProjectList();};
  modalColor.oninput=()=>{proj.color=modalColor.value;workspace.style.setProperty('--neon',proj.color);save();renderProject(proj);};
  modalImg.onchange=e=>{
    const f=e.target.files[0];if(!f)return;
    const r=new FileReader();
    r.onload=()=>{proj.image=r.result;save();renderProject(proj);};
    r.readAsDataURL(f);
  };
}

function isPathComplete(proj,node){
  if(!node.parent){const root=proj.nodes.find(n=>!n.parent);return root&&root.done;}
  const parent=proj.nodes.find(n=>n.id===node.parent);
  return parent&&parent.done&&isPathComplete(proj,parent);
}

function createNodeElement(node,color){
  const div=document.createElement('div');
  div.className='node';
  div.style.left=node.x+'px';div.style.top=node.y+'px';
  div.dataset.id=node.id;
  div.style.setProperty('--neon',color);
  const proj=data[currentProjectId];
  if(node.done&&isPathComplete(proj,node))div.classList.add('glow');
  div.innerHTML=`
    <div class="node-controls">
      <input type="checkbox" class="done" ${node.done?'checked':''}>
      <button class="addDown">‚Üì</button>
      <button class="addSide">‚Üí</button>
      <button class="deleteNodeBtn">‚ùå</button>
      <input type="file" class="imgInput" accept="image/*" style="width:60px">
    </div>
    <textarea>${node.text}</textarea>
    ${node.image?`<img src="${node.image}">`:''}`;
  nodesContainer.appendChild(div);

  div.querySelector('.done').onchange=e=>{
    node.done=e.target.checked;save();renderProject(data[currentProjectId]);
  };
  div.querySelector('.addDown').onclick=()=>addBranch(node.id,'down');
  div.querySelector('.addSide').onclick=()=>addBranch(node.id,'side');
  div.querySelector('.deleteNodeBtn').onclick=()=>deleteNode(node.id);
  div.querySelector('textarea').oninput=e=>{node.text=e.target.value;save();};
  div.querySelector('.imgInput').onchange=e=>{
    const f=e.target.files[0];if(!f)return;
    const r=new FileReader();
    r.onload=()=>{node.image=r.result;save();renderProject(data[currentProjectId]);};
    r.readAsDataURL(f);
  };
  enableDrag(div,node);
}

function deleteNode(nodeId){
  const proj=data[currentProjectId];
  // recursively delete children
  function remove(id){
    proj.nodes.filter(n=>n.parent===id).forEach(child=>remove(child.id));
    proj.nodes=proj.nodes.filter(n=>n.id!==id);
  }
  remove(nodeId);
  save();renderProject(proj);
}

function addBranch(parentId,dir){
  const proj=data[currentProjectId];
  const p=proj.nodes.find(n=>n.id===parentId);
  const newId='node-'+Date.now();
  const offset=dir==='down'?{x:0,y:250}:{x:300,y:0};
  const newNode={id:newId,text:'New Task',done:false,parent:parentId,
                 x:p.x+offset.x,y:p.y+offset.y,image:''};
  proj.nodes.push(newNode);save();renderProject(proj);
}

function drawConnections(proj){
  connections.innerHTML='';
  proj.nodes.forEach(n=>{
    if(n.parent){
      const p=proj.nodes.find(x=>x.id===n.parent);if(!p)return;
      const line=document.createElementNS('http://www.w3.org/2000/svg','line');
      const x1=(p.x+100)*scale+originX, y1=(p.y+100)*scale+originY;
      const x2=(n.x+100)*scale+originX, y2=(n.y)*scale+originY;
      line.setAttribute('x1',x1);line.setAttribute('y1',y1);
      line.setAttribute('x2',x2);line.setAttribute('y2',y2);
      line.classList.add('tube');
      if(p.done&&n.done&&isPathComplete(proj,n))line.classList.add('glow');
      line.style.setProperty('--neon',proj.color);
      connections.appendChild(line);
    }
  });
}

/* Drag & Drop grid-snap */
function enableDrag(div,node){
  let offX,offY,drag=false;
  div.addEventListener('pointerdown',e=>{
    if(['TEXTAREA','INPUT','BUTTON'].includes(e.target.tagName))return;
    drag=true;offX=e.clientX-node.x;offY=e.clientY-node.y;
    div.setPointerCapture(e.pointerId);
  });
  div.addEventListener('pointermove',e=>{
    if(!drag)return;
    const x=Math.round((e.clientX-offX)/50)*50;
    const y=Math.round((e.clientY-offY)/50)*50;
    node.x=x;node.y=y;div.style.left=x+'px';div.style.top=y+'px';
    drawConnections(data[currentProjectId]);
  });
  div.addEventListener('pointerup',()=>{if(!drag)return;drag=false;save();renderProject(data[currentProjectId]);});
}

/* Zoom + Pan */
let scale=1,originX=0,originY=0,isPanning=false,startX,startY;
workspace.addEventListener('mousedown',e=>{
  if(e.target.closest('.node'))return;
  isPanning=true;startX=e.clientX-originX;startY=e.clientY-originY;
  workspace.style.cursor='grabbing';
});
workspace.addEventListener('mousemove',e=>{
  if(!isPanning)return;
  originX=e.clientX-startX;originY=e.clientY-startY;
  applyTransform();drawConnections(data[currentProjectId]);
});
workspace.addEventListener('mouseup',()=>{isPanning=false;workspace.style.cursor='grab';});
workspace.addEventListener('wheel',e=>{
  e.preventDefault();
  const delta=e.deltaY>0?-0.1:0.1;
  scale=Math.min(2,Math.max(0.5,scale+delta));
  applyTransform();drawConnections(data[currentProjectId]);
});
zoomReset.onclick=()=>{scale=1;originX=0;originY=0;applyTransform();drawConnections(data[currentProjectId]);};

function applyTransform(){
  nodesContainer.style.transform=`translate(${originX}px,${originY}px) scale(${scale})`;
}

refreshProjectList();
const first=Object.keys(data)[0];
if(first)loadProject(first);
</script>
</body>
</html>
